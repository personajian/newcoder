[TOC]

前言

## 第1章 概述

### 1.1 分布式存储概念

分布式存储系统的特性：

- 可扩展性
- 低成本
- 高性能
- 易用

分布式存储技术主要来自两个领域：**分布式系统**和**分布式数据库**。

- 数据分布
- 一致性
- 容错
- 负载均衡
- 事务与并发控制
- 易用性
- 压缩/解压缩

### 1.2 分布式存储分类

根据结构、内容的关系划分类：

- 非结构化数据：纯内容，无结构——文档、文本、图片、图像等内容。
- 结构化数据：结构和内容是分开的——schema，关系型，二维关系。
- 半结构化数据：结构和内容混在一起——HTML文档等。

将分布式存储系统分为四类：

1. 分布式文件系统：非结构化数据——图片、照片、视频，二进制大对象（Binary Large Object，Blob）。常常作为分布式表格、分布式数据库的底层存储。使用数据库（chunk）来组织数据。
    1. Blob对象
    2. 定长块
    3. 大文件 
2. 分布式键值系统：关系简单的半结构化数据，只提供基于**主键**的CRUD。是分布式表格的一种简化实现，一般用作**缓存**
3. 分布式表格系统：
4. 分布式数据库 

分类|结构内容关系|使用技术|应用场景
---|---|---|---
分布式文件系统|非结构化数据|数据块（Blob、定长块、大文件）|
分布式键值系统|简单的半结构化|只基于主键的CRUD，一致性哈希|淘宝Tair，Memchache，Amazon DynamoDB
分布式表格系统|复杂的半结构化|表格，CRUD，主键范围|Google Bigtable
分布式数据库|结构化数据|二维表格|MySQL Sharding，Amazon RDS，Azure，NoSQL

# 第一篇 基础篇

## 第2章 单机存储系统

### 2.1 硬件基础

1. CPU架构
2. IO总线
3. 网络拓扑
4. 性能参数
5. 存储层次架构

### 2.2 单机存储引擎

1. 哈希存储引擎
2. B树存储引擎
3. LSM树存储引擎

### 2.3 数据模型
1. 文件模型
2. 关系模型
3. 键值模型
4. SQL与NoSQL

### 2.4 事务与并发控制

1. 事务
2. 并发控制

### 2.5 故障恢复

1. 操作日志
2. 重做日志
3. 优化手段

### 2.6 数据压缩

1. 压缩算法
2. 列式存储

## 第3章 分布式系统

### 3.1 基本概念
1. 异常
2. 一致性
3. 衡量指标

### 3.2 性能分析

### 3.3 数据分布

1. 哈希分布
2. 顺序分布
3. 负载均衡

### 3.4 复制

1. 复制的概述
2. 一致性与可用性

### 3.5 容错

1. 常见故障
2. 故障检测
3. 故障恢复

### 3.6 可扩展性

1. 总控节点
2. 数据库扩容
3. 异构系统

### 3.7 分布式协议

1. 两阶段提交协议
2. Paxos协议
3. Paxos与2PC

### 3.8 跨机房部署

# 第二篇 范型篇

## 第4章 分布式文件系统

### 4.1 Google文件系统

1. 系统架构
2. 关键问题
3. Master设计
4. ChunkServer设计
5. 讨论

### 4.2 Taobao File System

1. 系统架构
2. 讨论

### 4.3 Facebook Haystack

1. 系统架构
2. 讨论

### 4.4 内容分发网络

1. CDN架构
2. 讨论

## 第5章 分布式键值系统

### 5.1 Amazon Dynamo

1. 数据分布
2. 一致性与复制
3. 容错
4. 负载均衡
5. 读写流程
6. 单机实现
7. 讨论

### 5.2 淘宝Tair

1. 系统架构
2. 关键问题
3. 讨论

## 第6章 分布式表格系统

### 6.1 Google Bigtable

1. 架构
2. 数据分布
3. 复制与一致性
4. 容错
5. 负载均衡
6. 分裂与合并
7. 单机存储
8. 垃圾回收
9. 讨论

### 6.2 Google Megastore

1. 系统架构
2. 实体组
3. 并发控制
4. 复制
5. 索引
6. 协调者
7. 读取流程
8. 写入流程
9. 讨论

### 6.3 Windows Azure Storage

1. 整体架构
2. 文件流层
3. 分区层
4. 讨论

## 第7章 分布式数据库

### 7.1 数据库中间层

1. 架构
2. 扩容
3. 讨论

### 7.2 Microsoft SQL Azure

1. 数据模型
2. 架构
3. 复制与一致性
4. 容错
5. 负载均衡
6. 多租户
7. 讨论

### 7.3 Google Spanner

1. 数据模型
2. 架构
3. 复制与一致性
4. TrueTime
5. 并发控制
6. 数据迁移
7. 讨论

# 第三篇 实践篇

## 第8章 OceanBase架构初探

### 8.1 背景简介

### 8.2 设计思路

### 8.3 系统架构

1. 整体架构图
2. 客户端
3. RootServer
4. MergeServer
5. ChunkServer
6. UpdateServer
7. 定期合并&数据分发

### 8.4 架构剖析

1. 一致性选择
2. 数据结构
3. 可靠性与可用性
4. 读写事务
5. 单点性能
6. SSD支持
7. 数据正确性
8. 分层结构

## 第9章 分布式存储引擎

### 9.1 公共模块

1. 内存管理
2. 基础数据结构
3. 锁
4. 任务队列
5. 网络框架
6. 压缩与解压缩

### 9.2 RootServer实现机制

1. 数据结构
2. 子表复制与负载均衡
3. 子表分裂与合并
4. UpdateServer选主
5. RootServer主备

### 9.3 UpdateServer实现机制

1. 存储引擎
2. 任务模型
3. 主备同步

### 9.4 ChunkServer实现机制

1. 子表管理
2. SSTable
3. 缓存实现
4. IO实现
5. 定期合并&数据分发
6. 定期合并限速

### 9.5 消除更新瓶颈

1. 读写优化回顾
2. 数据旁路导入
3. 数据分区

## 第10章 数据库功能

### 10.1 整体结构

### 10.2 只读事务

1. 物理操作符接口
2. 单表操作
3. 多表操作
4. SQL执行本地化

### 10.3 写事务

1. 写事务执行流程
2. 多版本并发控制

### 10.4 OLAP业务支持

1. 并发查询
2. 列式存储

### 10.5 特色功能

1. 大表左连接
2. 数据过期与批量删除

## 第11章 质量保证、运维及实践

### 11.1 质量保证

1. RD开发
2. QA测试
3. 试运行

### 11.2 使用与运维

1. 使用
2. 运维

### 11.3 应用

1. 收藏夹
2. 天猫评价
3. 直通车报表

### 11.4 最佳实践

1. 系统发展路径
2. 人员成长
3. 系统设计
4. 系统实现
5. 使用与运维
6. 工程现象
7 经验法则

# 第四篇 专题篇

## 第12章 云存储

### 12.1 云存储的概念

### 12.2 云存储的产品形态

### 12.3 云存储技术

### 12.4 云存储的核心优势

### 12.5 云平台整体架构

1. Amazon云平台
2. Google云平台
3. Microsoft云平台
4. 云平台架构

### 12.6 云存储技术体系

### 12.7 云存储安全

## 第13章 大数据

### 13.1 大数据的概念

### 13.2 MapReduce

### 13.3 MapReduce扩展

1. Google Tenzing
2. Microsoft Dryad
3. Google Pregel

### 13.4 流式计算

1. 原理
2. Yahoo S4
3. Twitter Storm

### 13.5 实时分析

1. MPP架构
2. EMC Greenplum
3. HP Vertica
4. Google Dremel

参考资料