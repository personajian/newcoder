## 一、MyISAM

1. 不支持事务
2. 不支持行级锁
    - 读：表共享锁
    - 写：表独占锁
3. 索引、数据分开存储 
    - 索引.myi：存放指向数据物理地址
    - 数据.myd
4. 支持全文索引、BLOB、TEXT创索引
5. 压缩表
    - 不能修改，只读索引
    - 减少空间，I/O

## 二、InnoDB

1. 支持事务
2. 支持行级锁（通过MVCC来解决幻读）
3. 索引和数据一起存储
    - 采用聚簇索引+二级索引：主键——>数据行
4. 不支持全文索引，但是可以通过sphinx实现

## 三、索引的分类

### 3.1 物理实现

1. B-Tree索引
    - 全键值
    - 键值范围
    - 键前缀查找
2. 哈希索引
3. 自适应索引=B-Tree+哈希
4. 空间数据索引（R-Tree）
5. 全文索引
    - MyISAM
    - sphinx

### 3.2 分类

1. 前缀索引
2. 多列索引
3. 聚簇索引
4. 覆盖索引
5. 压缩索引

## 四、维护索引

```
EXPLAIN
SHOW STATUS
CHECK TABLE
REPAIR TABLE
ALTER
record_in_range()
info()
ANALYZE TABLE
OPTIMAZE TABLE
ALTER TABLE
```

## 五、选择合适的存储引擎

基于以下特征

- 事务
- 备份
- 崩溃恢复
- 特有特性：地理空间搜索、全文索引

具体应用场景：

1. 日志
    - 插入速度高：MyISAM，Archive
    - 分析日志：主写备读、加时间戳命令
2. 读多写少
    - MyISAM
    - InnoDB+聚簇索引
3. 订单处理
    - 事务、外键：InnoDB
4. 论坛
    - 一次查询多：MyISAM
5. 只读介质
    - MyISAM+压缩表（拷贝、索引）
6. 大数据量
    - 数据仓库


## 六、表和数据类型优化

### 6.1 

1. 更小的数据类型
2. 内建类型
3. 避免null：很难优化
    - 索引
    - 索引统计
    - 值比较
    - 更多存储空间

### 6.2 范式

1. 范式：写密集，更新修改快
2. 反范式：避免关联，查询快（冗余）

### 6.3 ALTER TABLE

1. 主库切换
2. 影子拷贝
3. 直接修改：表定义.frm

### 6.4 创建MyISAM索引

1. 先禁用索引，载入数据，启用索引
2. 删除非唯一索引，增列，重建删除掉的索引